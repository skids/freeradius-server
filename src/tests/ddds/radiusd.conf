# -*- text -*-
##
## ddds/radiusd.conf	-- config file for testing radiusd.
##
##	$Id$
##

test_port	= 10000

prefix = ../../build

# We do not actually need to proxy to test the DNS lookups
proxy_requests = no

thread pool {
       start_servers = 5
       max_servers = 32
       min_spare_servers = 3
       max_spare_servers = 10
       max_requests_per_server = 0
}

client test {
       ipaddr = 127.0.0.1
       secret = testing123
}

realm "~.+\\.site\\.?" {
}

modules {

	always ok {
               rcode = ok
               simulcount = 0
               mpp = no
	}

	expr {
	}

	idn {
	}

	realm suffix {
              format = suffix
              delimiter = "@"
	}

        ddds ddds_just_a {
             naptr = no
             srv = no
             fallback = 8888
             ipv6 = yes
             expiry_ttl = 600
             deadbeat_ttl = 15
	     negative_ttl = 60
             min_ttl = 15
	     unbound = just_a
        }

        ddds ddds_just_srv {
             naptr = no
             srv = yes
             ipv6 = yes
             expiry_ttl = 600
             deadbeat_ttl = 15
             negative_ttl = 60
             min_ttl = 15
	     max_ttl = 75
	     unbound = just_srv
        }

        ddds ddds_fb_srv {
             naptr = no
             fallback = 8889
             ipv6 = yes
             expiry_ttl = 600
             deadbeat_ttl = 15
	     negative_ttl = 60
	     max_ttl = 75
             min_ttl = 15
	     unbound = fb_srv
        }

        ddds ddds_just_naptr {
             naptr = yes
             srv = no
             ipv6 = yes
             expiry_ttl = 600
             deadbeat_ttl = 15
	     negative_ttl = 60
             min_ttl = 15
	     unbound = just_naptr
        }

        ddds ddds_naptr_srv {
	     naptr = yes
	     srv = yes
             ipv6 = yes
             expiry_ttl = 600
             deadbeat_ttl = 15
	     negative_ttl = 60
             min_ttl = 15
	     unbound = naptr_srv
        }

        ddds ddds_fb_naptr_srv {
             fallback = 8890
             ipv6 = yes
             expiry_ttl = 600
             deadbeat_ttl = 15
	     negative_ttl = 60
             min_ttl = 15
	     unbound = fb_naptr_srv
        }

        ddds ddds_fb_naptr {
             srv = no
             fallback = 8891
             ipv6 = yes
             expiry_ttl = 600
             deadbeat_ttl = 15
	     negative_ttl = 60
             min_ttl = 15
	     unbound = fb_naptr
        }

}

server test {
#       listen {
#	      type = detail
#	      filename = ${radacctdir}/detail
#	      load_factor = 10
#       }

       	listen {
		ipaddr = 127.0.0.1
		port = ${test_port}
		type = auth
	}

	listen {
		type = unbound
		unbound just_a {
       			unbound_conf = "ddds/just_a_ub.conf"
       		}
	}
	listen {
		type = unbound
		unbound just_srv {
       			unbound_conf = "ddds/just_srv_ub.conf"
       		}
	}
	listen {
		type = unbound
		unbound fb_srv {
       			unbound_conf = "ddds/fb_srv_ub.conf"
       		}
	}
	listen {
		type = unbound
		unbound just_naptr {
       			unbound_conf = "ddds/just_naptr_ub.conf"
       		}
	}
	listen {
		type = unbound
		unbound naptr_srv {
       			unbound_conf = "ddds/naptr_srv_ub.conf"
       		}
	}
	listen {
		type = unbound
		unbound fb_naptr_srv {
       			unbound_conf = "ddds/fb_naptr_srv_ub.conf"
       		}
	}
	listen {
		type = unbound
		unbound fb_naptr {
       			unbound_conf = "ddds/fb_naptr_ub.conf"
       		}
	}

	authorize {
		  suffix
	  	  if (Realm =~ /a\\.site\\.?/) {
	  	     	    ddds_just_a
	  	  }
	  	  if (Realm =~ /s\\.site\\.?/) {
	  	     	    ddds_just_srv
	  	  }
	  	  if (Realm =~ /n\\.site\\.?/) {
	  	     	    ddds_just_naptr
	  	  }
	  	  if (Realm =~ /f\\.site\\.?/) {
	  	     	    ddds_fb_srv
	  	  }
	  	  if (Realm =~ /g\\.site\\.?/) {
	  	     	    ddds_fb_naptr_srv
	  	  }
	  	  if (Realm =~ /m\\.site\\.?/) {
	  	     	    ddds_naptr_srv
	  	  }
		  if ("%{control:Home-Server-Pool}") {
		  }
		  ok
        }

	authenticate {
        }

	accounting {
#	   if (Packet-Src-IP-Address != 255.255.255.255) {
#	      detail
#	   }

	   ok
        }
}
